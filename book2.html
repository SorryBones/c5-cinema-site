<!DOCTYPE html>
<html lang="en">
<head>
    <title>UGA Flix</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="Home page" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>.checked {color: orange;}</style>
</head>

<body style="padding-top:55px ; background-color: black">
  
  <!--Navbar-->
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark" style="background-color: #272727;">
    <a class="navbar-brand" href="index.html">UGA Flix</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <form action="/index.html">
            <input class="btn" type="submit" value="Home" style="background-color:#272727 ; color:white">
          </form>
          <form action="/browse.html">
            <input class="btn" type="submit" value="Browse" style="background-color:#272727 ; color:white">
          </form>
          <form action="/profile.html">
            <input class="btn" id="profileButton" type="submit" value="Profile" style="background-color:#272727 ; color:white">
          </form>
          <form action="/login.html">
            <input class="btn" id="loginButton" type="submit" value="Login" style="background-color:#272727 ; color:white">
          </form>
        </ul>
    </div>
  </nav>

  <div class="div-browse-entry">
    <div class="div-browse-text">
      <img class="img-browse-entry" src="images/poster-default.png" id="poster"/>
        <p id="title">TITLE:</p>
        <p id="genre">GENRE:</p>
        <p id="rating">AGE RATING:</p>
        <p id="releaseDate">RELEASE DATE:</p>
        <p id="duration">RUN TIME:</p>
        <p id="director">DIRECTOR:</p>
        <p id="producer">PRODUCER:</p>
        <p id="cast">CAST:</p>
        <p id="description">DESCRIPTION:</p>
        <div id="audienceRating"></div>
    </div>
  </div>

  <div class="div-browse-entry" style="align-content: center; text-align:center">
    <h1>Trailer:</h1>
    <div class="embed-responsive embed-responsive-16by9" style="margin: 10px; width: 600px" id="video"></div>
  </div>

  <div class="div-browse-entry" style="align-content: center; text-align:center" id="showtimesDiv">
    <h1>Select a Showtime:</h1>
    <form action="/getSeats" method="POST">
      <div class="flex-entry-content-line">
          <div class="input-group mb-3 p-2">
            <div class="input-group-prepend">
              <span class="input-group-text text-light border border-danger" style="background-color: #272727;" id="basic-addon3">Showtimes:</span>
            </div>
            <select class="form-control" id="showtimeDiv" name="showtime">
              <option selected></option>
              <div id="allShowtimes"></div>
            </select required>
          </div>
      </div>
    </form>
    <button class="button-book-now" style="width: 150px" id="selectShowtime">Select</button>
  </div>

  <div id="selectSeatsDiv"><button class="button-book-now" style="width: 150px" id="selectSeatsButton">Select</button></div>

  <div id="bookSeatsDiv"></div>

  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
  integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
  crossorigin="anonymous"></script>

  <script>
    $(document).ready(function() {
      $.ajax( {
        url: "/isLoggedIn",
        type: "GET",
        success: function(result) {
          if (result.status == true) $('#loginButton').remove();
          else $('#profileButton').remove();
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
          console.log('failure');
        }
      });
    });
  </script>

  <script> // DISPLAY MOVIE INFO
    $(document).ready(function() {
        $.ajax( {
            url: "/getMovie",
            type: "GET",
            success: function(result) {
                console.log(result);
                var rating;
                if (result.ratings_id == 2) rating = 'PG';
                else if (result.ratings_id == 1) rating = 'PG-13';
                else if (result.ratings_id == 3) rating = 'R';

                let audienceRatingContent
                if (result.audience_rating == 1) audienceRatingContent = 'RATING: <span class="fa fa-star checked"></span><span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star"></span>';
                else if (result.audience_rating == 2) audienceRatingContent = 'RATING: <span class="fa fa-star checked"></span><span class="fa fa-star checked"><span class="fa fa-star"></span><span class="fa fa-star"></span><span class="fa fa-star"></span>';
                else if (result.audience_rating == 3) audienceRatingContent = 'RATING: <span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star"></span><span class="fa fa-star"></span>';
                else if (result.audience_rating == 4) audienceRatingContent = 'RATING: <span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star"></span>';
                else if (result.audience_rating == 5) audienceRatingContent = 'RATING: <span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star checked"></span><span class="fa fa-star checked">';

                let videoContent = '<iframe class="embed-responsive-item" src="' + result.video_url + '" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
                
                $("#title").html('TITLE: ' + result.title);
                $("#rating").html('RATING: ' + rating);
                $("#genre").html('GENRE: ' + result.genre);
                $("#releaseDate").html('RELEASE DATE: ' + result.release_date);
                $("#duration").html('DURATION: ' + result.duration);
                $("#director").html('DIRECTOR: ' + result.director);
                $("#producer").html('PRODUCER: ' + result.producer);
                $("#cast").html('CAST: ' + result.cast);
                $("#description").html('DESCRIPTION: ' + result.description);
                $("#poster").attr('src',result.img);
                document.getElementById("audienceRating").innerHTML = audienceRatingContent;
                document.getElementById("video").innerHTML = videoContent;
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                console.log('failure');
            }
        });
    });
</script>

<script> // SELECT A SHOWTIME
  $(document).ready(function() {
    $.ajax( {
      url: "/getAllShowtimes",
      type: "GET",
      success: function(result1) {
        if (result1.status == false) {
            document.getElementById('showtimesDiv').innerHTML = ''; // clear old
            var newDiv = document.createElement('div');
            newDiv.className = "flex-homepage-latest-movie";
            newDiv.style = "height: 27vh; width: 202vh";
            newDiv.innerHTML = "<h3>" + "No Showtimes Found" + "</h3>"
            document.getElementById('showtimesDiv').appendChild(newDiv);
        }
        else {
          var content = '<option value=""></option>';
          result1.forEach(createUserRow);
          function createUserRow(result) {
            var displayedDate = result.date.substring(0,10);
            content += '<option value="' + result.show_id + '">' + displayedDate + ' ' + result.time + '</option>'; // NEEDS TO BE BETTER FORMAT
          }
          document.getElementById('showtimeDiv').innerHTML = content;
        }
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
        console.log('failure');
      }
    });
  });
</script>

<script> // SELECT SEATS
  $(document).ready(function() {
    $("#selectShowtime").click(function() {
      $.ajax( {
        url: "/getSeats",
        type: "POST",
        dataType: 'json',
        contentType: 'application/x-www-form-urlencoded',
        data: $.param({showId: document.getElementById("showtimeDiv").value}),
        processData: false,
        success: function(result1) {
          var content = '<form action="/test" method="POST">';
          content += '<div class="div-book-chart d-flex flex-column" style="text-align: center; align-items: center">';
          content += '<h1>Select a Seat:</h1><br>';
          content += '<div style="background: white; width: 500px; height: 45px; border: 2px solid #000; border-radius: 15px; -moz-border-radius: 15px; color:black"><h2>Screen</h2></div><br>';
          content += '<div data-toggle="buttons" id="seats">';
          result1.forEach(createUserRow);
          function createUserRow(result) {
            if (result.availability === 1) {
              content += '<label class="btn btn-primary" style="width: 45px; height: 45px; margin: 2px"><input type="checkbox" style="display:none" name="' + result.seat_number + '">' + result.seat_number + '</label>';
            } else { // exception: unavailable
              content += '<label class="btn btn-secondary" style="width: 45px; height: 45px"><input type="checkbox" style="display:none">' + result.seat_number + '</label>';
            }
            if (result.seat_number === 10) content += '<br><br><label style="width: 94px"></label>';
            if ((result.seat_number - 2) % 8 === 0 && result.seat_number > 10) content += '<br><label style="width: 94px"></label>';
          }
          content += '</div><br></form></div>';
          document.getElementById('selectSeatsDiv').innerHTML = content;
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
          console.log('failure');
        }
      });
    });
  });
</script>

<script> // BOOK SEATS
  $(document).ready(function() {
    $("#selectSeatsButton").click(function() { // selectSeatsButton not being clicked?
      console.log('test');
      //var content = '<form action="/bookTickets" method="POST">';
      //content += '<div class="div-browse-entry" style="align-content: center; text-align:center" id="bookSeatsDiv">'
      //console.log(document.getElementById('seats').value);
      //result1.forEach(createUserRow);
      //function createUserRow(result) {
        //if (result.availability === 1) {
        //  content += '<label class="btn btn-primary" style="width: 45px; height: 45px; margin: 2px"><input type="checkbox" style="display:none" name="' + result.seat_number + '">' + result.seat_number + '</label>';
        //} else { // exception: unavailable
        //  content += '<label class="btn btn-secondary" style="width: 45px; height: 45px"><input type="checkbox" style="display:none">' + result.seat_number + '</label>';
        //}
        //if (result.seat_number === 10) content += '<br><br><label style="width: 94px"></label>';
        //if ((result.seat_number - 2) % 8 === 0 && result.seat_number > 10) content += '<br><label style="width: 94px"></label>';
      //}
      //content += '<input class="button-book-now" type="submit" value="Book Now!"></form></div>';
      //document.getElementById('bookSeatsDiv').innerHTML = content;
    });
  });
</script>

<!-- <form action="/bookTickets" method="POST">
  <h3>Seat 42</h3>
  <div class="input-group-prepend" style="width: 300px">
    <input class="form-register" style="display:none" type="seat_id" id="seat_id" name="seat_id" placeholder=42><br><br>
    <span class="input-group-text text-light border border-danger" style="background-color: #272727; height: 38px" id="">Seat Type</span>
    <select class="form-control" id="ticketType" required>
      <option selected></option>
      <option value="1">Adult = $14.99</option>
      <option value="2">Child = $10.99</option>
      <option value="3">Senior = $12.99</option>
    </select>
  </div><br>

  <h3>Seat 43</h3>
  <div class="input-group-prepend" style="width: 300px">
    <input class="form-register" style="display:none" type="seat_id" id="seat_id" name="seat_id" placeholder=42><br><br>
    <span class="input-group-text text-light border border-danger" style="background-color: #272727; height: 38px" id="">Seat Type</span>
    <select class="form-control" id="ticketType" required>
      <option selected></option>
      <option value="1">Adult = $14.99</option>
      <option value="2">Child = $10.99</option>
      <option value="3">Senior = $12.99</option>
    </select>
  </div><br>

  <h3>Seat 44</h3>
  <div class="input-group-prepend" style="width: 300px">
    <input class="form-register" style="display:none" type="seat_id" id="seat_id" name="seat_id" placeholder=42><br><br>
    <span class="input-group-text text-light border border-danger" style="background-color: #272727; height: 38px" id="">Seat Type</span>
    <select class="form-control" id="ticketType" required>
      <option selected></option>
      <option value="1">Adult = $14.99</option>
      <option value="2">Child = $10.99</option>
      <option value="3">Senior = $12.99</option>
    </select>
  </div><br>

  <input class="button-book-now" type="submit" value="Book Now!">
</form> -->

</body>
</html>